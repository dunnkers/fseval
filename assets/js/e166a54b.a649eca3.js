"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[92],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),c=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(a),u=r,k=m["".concat(o,".").concat(u)]||m[u]||d[u]||l;return a?n.createElement(k,s(s({ref:t},p),{},{components:a})):n.createElement(k,s({ref:t},p))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=m;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<l;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7988:function(e,t,a){a.r(t),a.d(t,{assets:function(){return o},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return i},toc:function(){return c}});var n=a(3117),r=(a(7294),a(3905));const l={title:"Callbacks",sidebar_position:9},s="Callbacks",i={unversionedId:"config/callbacks",id:"config/callbacks",title:"Callbacks",description:"Callbacks are responsible for storing the experiment config and results. Any callback can be used on its own, but multiple callbacks can also be used at the same time.",source:"@site/docs/config/callbacks.mdx",sourceDirName:"config",slug:"/config/callbacks",permalink:"/fseval/docs/config/callbacks",draft:!1,editUrl:"https://github.com/dunnkers/fseval/tree/website/docs/config/callbacks.mdx",tags:[],version:"current",sidebarPosition:9,frontMatter:{title:"Callbacks",sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"Metrics",permalink:"/fseval/docs/config/metrics"},next:{title:"fseval.types.CacheUsage",permalink:"/fseval/docs/types/CacheUsage"}},o={},c=[{value:"To CSV",id:"to-csv",level:2},{value:"To SQL",id:"to-sql",level:2},{value:"To Weights and Biases",id:"to-weights-and-biases",level:2},{value:"\u2699\ufe0f Custom Callbacks",id:"\ufe0f-custom-callbacks",level:2}],p={toc:c};function d(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"callbacks"},"Callbacks"),(0,r.kt)("p",null,"Callbacks are responsible for storing the experiment config and results. Any callback can be used on its own, but multiple callbacks can also be used at the same time."),(0,r.kt)("h2",{id:"to-csv"},"To CSV"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'class fseval.config.callbacks.ToCSVCallback(\n    dir: str=MISSING,\n    mode: str="a",\n)\n')),(0,r.kt)("p",null,"CSV support for fseval. Uploads general information on the experiment to a ",(0,r.kt)("inlineCode",{parentName:"p"},"experiments")," table and provides a hook for uploading custom tables."),(0,r.kt)("p",null,"By default, four ",(0,r.kt)("inlineCode",{parentName:"p"},".csv")," files are created:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-commandline",metastring:'title="$ tree ~/Downloads/fseval_csv_results_dir"',title:'"$',tree:!0,'~/Downloads/fseval_csv_results_dir"':!0},"/Users/dunnkers/Downloads/fseval_csv_results_dir\n\u251c\u2500\u2500 experiments.csv\n\u251c\u2500\u2500 feature_importances.csv\n\u251c\u2500\u2500 ranking_scores.csv\n\u2514\u2500\u2500 validation_scores.csv\n\n0 directories, 4 files\n")),(0,r.kt)("p",null,"\ud83d\udca1 More tables or metrics can be configured using ",(0,r.kt)("a",{parentName:"p",href:"../metrics/#%EF%B8%8F-custom-metrics"},"Custom metrics"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Attributes"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"dir")," : str"),(0,r.kt)("td",{parentName:"tr",align:null},"The directory to save all CSV files to. For example, in this directory a file ",(0,r.kt)("inlineCode",{parentName:"td"},"experiments.csv")," will be created, containing the config of all experiments that were run.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"mode")," : str"),(0,r.kt)("td",{parentName:"tr",align:null},'Whether to overwrite or append. Use "a" for appending and "w" for overwriting.')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,"Use with ",(0,r.kt)("inlineCode",{parentName:"p"},"+callbacks='[to_csv]' +callbacks.to_csv.dir=<save_dir>")," on the commandline, or:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{4-5,7-9}","{4-5,7-9}":!0},"defaults:\n  - base_pipeline_config\n  - _self_\n  - override /callbacks:\n      - to_csv\n\ncallbacks:\n    to_csv:\n        dir: <save_dir>\n")),(0,r.kt)("h2",{id:"to-sql"},"To SQL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'class fseval.config.callbacks.ToSQLCallback(\n    url: str=MISSING,\n    kwargs: Dict=field(default_factory=lambda: {}),\n    if_table_exists: str="append"\n)\n')),(0,r.kt)("p",null,"SQL support for fseval. Achieved through integration with ",(0,r.kt)("a",{parentName:"p",href:"https://www.sqlalchemy.org/"},"SQLAlchemy"),". Uploads general information on the experiment to a ",(0,r.kt)("inlineCode",{parentName:"p"},"experiments")," table and provides a hook for uploading custom tables."),(0,r.kt)("p",null,"For example, by default the following four tables are uploaded:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"to sql callback example",src:a(6304).Z,width:"1039",height:"525"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"experiments")," contains an entry for each ran experiment. Contains a column for a local path,"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"feature_importances")," contains the estimated feature importances - given the ranker estimates them. Created by the ",(0,r.kt)("a",{parentName:"li",href:"../metrics/#featureimportances"},"FeatureImportances")," metric."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ranking_scores")," contains the fitting time for each ranker fit. Created by the ",(0,r.kt)("a",{parentName:"li",href:"../metrics/#rankingscores"},"RankingScores")," metric."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"validation_scores")," contains the validation estimator scores, for each feature subset that was evaluated. Created by the ",(0,r.kt)("a",{parentName:"li",href:"../metrics/#validationscores"},"Validation Scores")," metric.")),(0,r.kt)("p",null,"\ud83d\udca1 More tables or metrics can be configured using ",(0,r.kt)("a",{parentName:"p",href:"../metrics/#%EF%B8%8F-custom-metrics"},"Custom metrics"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Attributes"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url")," : str"),(0,r.kt)("td",{parentName:"tr",align:null},"The database URL. Is of type RFC-1738, e.g. ",(0,r.kt)("inlineCode",{parentName:"td"},"dialect+driver://username:password@host:port/database")," See the SQLAlchemy documentation for more information; ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls"},"https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kwargs")," : Dict"),(0,r.kt)("td",{parentName:"tr",align:null},"All keyword arguments to pass to SQLAlchemy's ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlalchemy.org/en/14/core/engines.html#sqlalchemy.create_engine"},(0,r.kt)("inlineCode",{parentName:"a"},"create_engine"))," function. @see; ",(0,r.kt)("a",{parentName:"td",href:"https://docs.sqlalchemy.org/en/14/core/engines.html#sqlalchemy.create_engine"},"https://docs.sqlalchemy.org/en/14/core/engines.html#sqlalchemy.create_engine"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"if_table_exists")," : str"),(0,r.kt)("td",{parentName:"tr",align:null},"What to do when a table of the specified name already exists. Can be 'fail', 'replace' or 'append'. By default is 'append'. For more info, see the ",(0,r.kt)("a",{parentName:"td",href:"https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_sql.html"},"Pandas.DataFrame#to_sql")," function.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,"Use with ",(0,r.kt)("inlineCode",{parentName:"p"},"+callbacks='[to_sql]' +callbacks.to_sql.url=<db_url>")," on the commandline, or:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{4-5,7-9}","{4-5,7-9}":!0},"defaults:\n  - base_pipeline_config\n  - _self_\n  - override /callbacks:\n      - to_sql\n\ncallbacks:\n    to_sql:\n        url: <db_url>\n")),(0,r.kt)("h2",{id:"to-weights-and-biases"},"To Weights and Biases"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"class fseval.config.callbacks.ToWandbCallback(\n    log_metrics: bool=True,\n    wandb_init_kwargs: Dict[str, Any]=field(default_factory=lambda: {}),\n)\n")),(0,r.kt)("p",null,"Support for exporting the job config and result tables to ",(0,r.kt)("a",{parentName:"p",href:"https://wandb.ai/"},"Weights and Biases"),"."),(0,r.kt)("p",null,"The results are stored in wandb ",(0,r.kt)("a",{parentName:"p",href:"https://docs.wandb.ai/guides/data-vis/log-tables"},"Tables"),". For example, we can create a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.wandb.ai/ref/app/features/custom-charts"},"Custom chart")," like so:"),(0,r.kt)("div",{className:"row"},(0,r.kt)("div",{className:"col col--8"},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"wandb tables example",src:a(8960).Z,width:"739",height:"626"}))),(0,r.kt)("div",{className:"col col--4"},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"wandb custom chart button example",src:a(8823).Z,width:"421",height:"512"})))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"wandb custom chart example",src:a(459).Z,width:"1289",height:"586"})),(0,r.kt)("p",null,"Which then allows us to compare the performance of different algorithms right in the dashboard."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Attributes"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"log_metrics")," : bool"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether to log metrics. In the case of a resumation run, a user might probably not want to log metrics, but just update the tables instead.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"wandb_init_kwargs")," : Dict","[str, Any]"),(0,r.kt)("td",{parentName:"tr",align:null},"Any additional settings to be passed to ",(0,r.kt)("inlineCode",{parentName:"td"},"wandb.init()"),". See the function signature for details; ",(0,r.kt)("a",{parentName:"td",href:"https://docs.wandb.ai/ref/python/init"},"https://docs.wandb.ai/ref/python/init"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,"Use with ",(0,r.kt)("inlineCode",{parentName:"p"},"+callbacks='[to_wandb]' +callbacks.to_wandb.wandb_init_kwargs.project=new_project")," on the commandline, or:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{4-5,7-10}","{4-5,7-10}":!0},"defaults:\n  - base_pipeline_config\n  - _self_\n  - override /callbacks:\n      - to_wandb\n\ncallbacks:\n    to_wandb:\n        wandb_init_kwargs:\n            project: my_wandb_project\n")),(0,r.kt)("h2",{id:"\ufe0f-custom-callbacks"},"\u2699\ufe0f Custom Callbacks"),(0,r.kt)("p",null,"To create a custom callback, implement the following interface:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"class Callback(ABC):\n    def on_begin(self, config: DictConfig):\n        ...\n\n    def on_config_update(self, config: Dict):\n        ...\n\n    def on_table(self, df: pd.DataFrame, name: str):\n        ...\n\n    def on_summary(self, summary: Dict):\n        ...\n\n    def on_end(self, exit_code: Optional[int] = None):\n        ...\n")),(0,r.kt)("p",null,"For example implementations, check the fseval repository ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dunnkers/fseval/tree/master/fseval/callbacks"},(0,r.kt)("inlineCode",{parentName:"a"},"fseval/callbacks"))," directory, and its associated ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dunnkers/fseval/tree/master/fseval/conf/callbacks"},"yaml configs"),"."))}d.isMDXComponent=!0},6304:function(e,t,a){t.Z=a.p+"assets/images/to_sql-d83c01b2ebb72c8ff68a7d6771a26b96.png"},8823:function(e,t,a){t.Z=a.p+"assets/images/wandb-custom-chart-button-71f4a15121344d12b536fa52d8216330.png"},459:function(e,t,a){t.Z=a.p+"assets/images/wandb-custom-chart-82f4b7ff1e8e08996a915abdb99c5df9.png"},8960:function(e,t,a){t.Z=a.p+"assets/images/wandb-tables-example-6124684ead63ade792bdaffbc203dc91.png"}}]);