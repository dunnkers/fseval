"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[450],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9128:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return o},default:function(){return p},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return u}});var a=n(3117),r=(n(7294),n(3905));const i={},o="Running on AWS",s={unversionedId:"recipes/running-on-aws",id:"recipes/running-on-aws",title:"Running on AWS",description:"Let's see how easy it is to run fseval jobs on AWS. We are going to do this using the Ray launcher from Hydra. We are going to take the quick start example and run it on an AWS cluster. Specifically, EC2.",source:"@site/docs/recipes/running-on-aws.md",sourceDirName:"recipes",slug:"/recipes/running-on-aws",permalink:"/fseval/docs/recipes/running-on-aws",draft:!1,editUrl:"https://github.com/dunnkers/fseval/tree/website/docs/recipes/running-on-aws.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Comparing Feature Selectors",permalink:"/fseval/docs/recipes/comparing-feature-selectors"}},l={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing the required packages",id:"installing-the-required-packages",level:3},{value:"Authenticating to AWS",id:"authenticating-to-aws",level:3},{value:"Experiment setup",id:"experiment-setup",level:2},{value:"Running the experiment",id:"running-the-experiment",level:2},{value:"\ud83c\udf10 Sources",id:"-sources",level:2}],c={toc:u};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"running-on-aws"},"Running on AWS"),(0,r.kt)("p",null,"Let's see how easy it is to run ",(0,r.kt)("inlineCode",{parentName:"p"},"fseval")," jobs on AWS. We are going to do this using the ",(0,r.kt)("a",{parentName:"p",href:"https://hydra.cc/docs/1.2/plugins/ray_launcher/"},"Ray launcher")," from Hydra. We are going to take the quick start example and run it on an AWS cluster. Specifically, EC2."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"We are going to use more or less the same configuration as we did in the ",(0,r.kt)("a",{parentName:"p",href:"../../quick-start"},"Quick start")," example. Again, start by downloading the example project: ",(0,r.kt)("a",{parentName:"p",href:"pathname:///fseval/zipped-examples/running-on-aws-using-ray.zip"},"running-on-aws-using-ray.zip")),(0,r.kt)("h3",{id:"installing-the-required-packages"},"Installing the required packages"),(0,r.kt)("p",null,"Now, let's install the required packages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pip install hydra-ray-launcher --upgrade\npip install ray[default]==1.13.0\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"We require Ray version 1.13 and up, because it contains a fix regarding ",(0,r.kt)("inlineCode",{parentName:"p"},"protobuf")," that is necessary for our setup.")),(0,r.kt)("h3",{id:"authenticating-to-aws"},"Authenticating to AWS"),(0,r.kt)("p",null,"Make sure you are authenticated to AWS. Ray uses either the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvar"},"environment variables")," or your AWS profile stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.aws")," (run ",(0,r.kt)("inlineCode",{parentName:"p"},"aws configure")," to install a profile) to read your authentication details. Make sure you have the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html"},"AWS V2")," installed."),(0,r.kt)("p",null,"You can test your authentication as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"aws sts get-caller-identity\n")),(0,r.kt)("p",null,"\u2713 which should give you some output."),(0,r.kt)("p",null,"\u2715 if this does not yet work, see AWS's elorate guide on authenticating the CLI for more info: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html"},"AWS CLI Configuration basics"),". "),(0,r.kt)("h2",{id:"experiment-setup"},"Experiment setup"),(0,r.kt)("p",null,"In the experiment, we configured the main config file like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/my_config.yaml"',title:'"conf/my_config.yaml"'},"defaults:\n  - base_pipeline_config\n  - _self_\n  - override dataset: synthetic\n  - override validator: knn\n  - override /callbacks:\n      - to_sql\n  // highlight-start\n  - override hydra/launcher: custom_ray_aws\n  // highlight-end\n\nn_bootstraps: 1\ncallbacks:\n  to_sql:\n    url: sqlite:////home/ubuntu/results/results.sqlite # any well-defined database URL\n\n")),(0,r.kt)("p",null,"Here, we are configuring to use a new launcher called ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_ray_aws"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/hydra/launcher/custom_ray_aws.yaml"',title:'"conf/hydra/launcher/custom_ray_aws.yaml"'},"defaults:\n  - ray_aws\n\nenv_setup:\n  pip_packages:\n    fseval: 3.0.3\n\nray:\n  cluster:\n    # Mount our code to the execution directory on both the head- and worker nodes.\n    # See: https://docs.ray.io/en/master/cluster/vms/references/ray-cluster-configuration.html#cluster-configuration-file-mounts\n    file_mounts:\n      /home/ubuntu: benchmark.py\n\n    initialization_commands:\n      - mkdir -p /home/ubuntu/results\n\nsync_down:\n  source_dir: /home/ubuntu/results\n  target_dir: .\n")),(0,r.kt)("p",null,"In this launcher config, a lot of stuff is happening. In short:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"fseval")," is installed on the EC2 cluster node")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once a node has been started, ",(0,r.kt)("inlineCode",{parentName:"p"},"benchmark.py")," is mounted into the home folder. Ray by default runs all experiments from this folder. This is such that we can correctly instantiate any classes that were defined in the config as a ",(0,r.kt)("inlineCode",{parentName:"p"},"_target_"),"."),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"}," If you would like to explore with a terminal inside a node, try setting ",(0,r.kt)("inlineCode",{parentName:"p"},"stop_cluster: false")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_ray_config.yaml"),", run an experiment, and then ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html"},"connect to your EC2 instance with SSH"),"."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"An initialization command is run to make sure the ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/ubuntu/results")," directory exists. We configured our SQLite table to be stored inside this folder.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Finally, once the experiment has been finished, download everything inside of ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/ubuntu/results")," to the current working directory (",(0,r.kt)("inlineCode",{parentName:"p"},"."),")."))),(0,r.kt)("h2",{id:"running-the-experiment"},"Running the experiment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"python benchmark.py --multirun ranker='glob(*)'\n")),(0,r.kt)("p",null,"Now, the experiment should start running, on AWS! Ray automatically instantiates and configures nodes on EC2, ships your code, installs ",(0,r.kt)("inlineCode",{parentName:"p"},"fseval"),", and runs the experiments. Cool!"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"feature selectors algorithm stability",src:n(1952).Z,width:"1958",height:"582"})),(0,r.kt)("p",null,"\ud83d\ude4c\ud83c\udffb"),(0,r.kt)("p",null,"The results are downloaded back to your local computer, and are available in the ",(0,r.kt)("inlineCode",{parentName:"p"},"results")," folder:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(base) \u279c  running-on-aws-using-ray git:(recipe/running-on-aws) \u2717 tree results\nresults\n\u2514\u2500\u2500 results.sqlite\n\n0 directories, 1 file\n")),(0,r.kt)("p",null,"In this way, it's possible to run experiments on a massive scale, by using Amazon's datacentres for scaling."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"-sources"},"\ud83c\udf10 Sources"),(0,r.kt)("p",null,"For more information, see the following sources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://hydra.cc/docs/1.2/plugins/ray_launcher/"},"Hydra's Ray Launcher plugin docs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.ray.io/en/master/cluster/vms/references/ray-cluster-configuration.html"},"Ray YAML configuration options")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://aws.amazon.com/ec2/instance-types/"},"EC2 instances types")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html"},"EC2 custom AMI types")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev.to/chrisgreening/connecting-to-a-relational-database-using-sqlalchemy-and-python-1619"},"Connecting to a live database instead of saving to a local ",(0,r.kt)("inlineCode",{parentName:"a"},".sqlite")," file"))))}p.isMDXComponent=!0},1952:function(e,t,n){t.Z=n.p+"assets/images/running-on-aws-75870d733c8ad650bd7ff2c8b74c088a.gif"}}]);